<!DOCTYPE html>
<html>

<!-- Mirrored from www.iXi.com/prevention/sql-injection by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 14 Aug 2022 09:49:34 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>

  <title>Protecting Against SQL Injection</title>

  <link rel="shortcut icon" type="image/x-icon" href="https://d1o5lmfp4gliop.cloudfront.net/assets/favicon-d2fd4b2666fd6a6c2eacee13d0d844a558942079e549b7f971085de9cab55511.ico" />

  <link rel="apple-touch-icon"                 href="../touch-icon-iphone.png">
  <link rel="apple-touch-icon" sizes="76x76"   href="../touch-icon-ipad.png">
  <link rel="apple-touch-icon" sizes="120x120" href="../touch-icon-iphone-retina.png">
  <link rel="apple-touch-icon" sizes="152x152" href="../touch-icon-ipad-retina.png">

  <meta name="viewport" content="width=device-width">

  <link rel="stylesheet" media="all" href="../../d1o5lmfp4gliop.cloudfront.net/assets/application-bd10ee974bbc51bb3d86fa9ae10645db2b3eb4dc3d8cc7ce69082d3b5ef323f2.css" />
  <script src="../../d1o5lmfp4gliop.cloudfront.net/assets/application-70c4df94450edcfd2aaba387739ebbeae5cc4e79db9eec96837bd15cf2ea700e.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="AjFDWxGws+30nh1Pt2IxQTwJL4QE2cT/HP/ABniELiiQ5g20U2gFqrJaJPn8wGmgWLh5PknB4u5K99o01G9QYw==" />

  

  <meta property="og:url"          content="https://www.iXi.com/prevention/sql-injection" />
<meta property="og:type"         content="website" />
<meta property="og:title"        content="Protecting Against SQL Injection" />
<meta property="og:description"  content="If you are vulnerable to SQL Injection, attackers can run arbitrary commands against your database. Ready to see how? →" />
<meta property="og:image"        content="https://www.iXi.comhttps://d1o5lmfp4gliop.cloudfront.net/images/exercises/sql-injection/screenshot.png" />
<meta property="og:site_name"    content="iXi"/>

<meta property="fb:app_id"       content="495778420623064">

<meta name="description"         content="If you are vulnerable to SQL Injection, attackers can run arbitrary commands against your database. Ready to see how? →" />

<meta name="twitter:title"       content="Protecting Against SQL Injection">
<meta name="twitter:description" content="If you are vulnerable to SQL Injection, attackers can run arbitrary commands against your database. Ready to see how? → %>">

<meta name="application-name"                content="iXi"/>
<meta name="msapplication-TileColor"         content="#000000"/>
<meta name="msapplication-square70x70logo"   content="windows-tiny.png"/>
<meta name="msapplication-square150x150logo" content="windows-square.png"/>
<meta name="msapplication-wide310x150logo"   content="windows-wide.png"/>
<meta name="msapplication-square310x310logo" content="windows-large.png"/>


  
  <script>
    let _rollbarConfig = {
      accessToken: "7292cc33ae3843d4bc12aa01e4d82436",
      captureUncaught: true,
      captureUnhandledRejections: true,
      payload: {
        environment: "production",
        user: "unknown"
      },
      hostSafeList: ['iXi.com', 'www.iXi.com', 'app.iXi.com'],
      ignoredMessages: ["jQuery is missing", "Can't find variable ga"]
    };

    !function(r){var e={};function o(n){if(e[n])return e[n].exports;var t=e[n]={i:n,l:!1,exports:{}};return r[n].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=r,o.c=e,o.d=function(r,e,n){o.o(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:n})},o.r=function(r){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},o.t=function(r,e){if(1&e&&(r=o(r)),8&e)return r;if(4&e&&"object"==typeof r&&r&&r.__esModule)return r;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:r}),2&e&&"string"!=typeof r)for(var t in r)o.d(n,t,function(e){return r[e]}.bind(null,t));return n},o.n=function(r){var e=r&&r.__esModule?function(){return r.default}:function(){return r};return o.d(e,"a",e),e},o.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},o.p="",o(o.s=0)}([function(r,e,o){var n=o(1),t=o(4);_rollbarConfig=_rollbarConfig||{},_rollbarConfig.rollbarJsUrl=_rollbarConfig.rollbarJsUrl||"https://cdnjs.cloudflare.com/ajax/libs/rollbar.js/2.13.0/rollbar.min.js",_rollbarConfig.async=void 0===_rollbarConfig.async||_rollbarConfig.async;var a=n.setupShim(window,_rollbarConfig),l=t(_rollbarConfig);window.rollbar=n.Rollbar,a.loadFull(window,document,!_rollbarConfig.async,_rollbarConfig,l)},function(r,e,o){var n=o(2);function t(r){return function(){try{return r.apply(this,arguments)}catch(r){try{console.error("[Rollbar]: Internal error",r)}catch(r){}}}}var a=0;function l(r,e){this.options=r,this._rollbarOldOnError=null;var o=a++;this.shimId=function(){return o},"undefined"!=typeof window&&window._rollbarShims&&(window._rollbarShims[o]={handler:e,messages:[]})}var i=o(3),s=function(r,e){return new l(r,e)},d=function(r){return new i(s,r)};function c(r){return t(function(){var e=Array.prototype.slice.call(arguments,0),o={shim:this,method:r,args:e,ts:new Date};window._rollbarShims[this.shimId()].messages.push(o)})}l.prototype.loadFull=function(r,e,o,n,a){var l=!1,i=e.createElement("script"),s=e.getElementsByTagName("script")[0],d=s.parentNode;i.crossOrigin="",i.src=n.rollbarJsUrl,o||(i.async=!0),i.onload=i.onreadystatechange=t(function(){if(!(l||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)){i.onload=i.onreadystatechange=null;try{d.removeChild(i)}catch(r){}l=!0,function(){var e;if(void 0===r._rollbarDidLoad){e=new Error("rollbar.js did not load");for(var o,n,t,l,i=0;o=r._rollbarShims[i++];)for(o=o.messages||[];n=o.shift();)for(t=n.args||[],i=0;i<t.length;++i)if("function"==typeof(l=t[i])){l(e);break}}"function"==typeof a&&a(e)}()}}),d.insertBefore(i,s)},l.prototype.wrap=function(r,e,o){try{var n;if(n="function"==typeof e?e:function(){return e||{}},"function"!=typeof r)return r;if(r._isWrap)return r;if(!r._rollbar_wrapped&&(r._rollbar_wrapped=function(){o&&"function"==typeof o&&o.apply(this,arguments);try{return r.apply(this,arguments)}catch(o){var e=o;throw e&&("string"==typeof e&&(e=new String(e)),e._rollbarContext=n()||{},e._rollbarContext._wrappedSource=r.toString(),window._rollbarWrappedError=e),e}},r._rollbar_wrapped._isWrap=!0,r.hasOwnProperty))for(var t in r)r.hasOwnProperty(t)&&(r._rollbar_wrapped[t]=r[t]);return r._rollbar_wrapped}catch(e){return r}};for(var p="log,debug,info,warn,warning,error,critical,global,configure,handleUncaughtException,handleAnonymousErrors,handleUnhandledRejection,captureEvent,captureDomContentLoaded,captureLoad".split(","),u=0;u<p.length;++u)l.prototype[p[u]]=c(p[u]);r.exports={setupShim:function(r,e){if(r){var o=e.globalAlias||"Rollbar";if("object"==typeof r[o])return r[o];r._rollbarShims={},r._rollbarWrappedError=null;var a=new d(e);return t(function(){e.captureUncaught&&(a._rollbarOldOnError=r.onerror,n.captureUncaughtExceptions(r,a,!0),e.wrapGlobalEventHandlers&&n.wrapGlobals(r,a,!0)),e.captureUnhandledRejections&&n.captureUnhandledRejections(r,a,!0);var t=e.autoInstrument;return!1!==e.enabled&&(void 0===t||!0===t||"object"==typeof t&&t.network)&&r.addEventListener&&(r.addEventListener("load",a.captureLoad.bind(a)),r.addEventListener("DOMContentLoaded",a.captureDomContentLoaded.bind(a))),r[o]=a,a})()}},Rollbar:d}},function(r,e){function o(r,e,o){if(e.hasOwnProperty&&e.hasOwnProperty("addEventListener")){for(var n=e.addEventListener;n._rollbarOldAdd&&n.belongsToShim;)n=n._rollbarOldAdd;var t=function(e,o,t){n.call(this,e,r.wrap(o),t)};t._rollbarOldAdd=n,t.belongsToShim=o,e.addEventListener=t;for(var a=e.removeEventListener;a._rollbarOldRemove&&a.belongsToShim;)a=a._rollbarOldRemove;var l=function(r,e,o){a.call(this,r,e&&e._rollbar_wrapped||e,o)};l._rollbarOldRemove=a,l.belongsToShim=o,e.removeEventListener=l}}r.exports={captureUncaughtExceptions:function(r,e,o){if(r){var n;if("function"==typeof e._rollbarOldOnError)n=e._rollbarOldOnError;else if(r.onerror){for(n=r.onerror;n._rollbarOldOnError;)n=n._rollbarOldOnError;e._rollbarOldOnError=n}e.handleAnonymousErrors();var t=function(){var o=Array.prototype.slice.call(arguments,0);!function(r,e,o,n){r._rollbarWrappedError&&(n[4]||(n[4]=r._rollbarWrappedError),n[5]||(n[5]=r._rollbarWrappedError._rollbarContext),r._rollbarWrappedError=null);var t=e.handleUncaughtException.apply(e,n);o&&o.apply(r,n),"anonymous"===t&&(e.anonymousErrorsPending+=1)}(r,e,n,o)};o&&(t._rollbarOldOnError=n),r.onerror=t}},captureUnhandledRejections:function(r,e,o){if(r){"function"==typeof r._rollbarURH&&r._rollbarURH.belongsToShim&&r.removeEventListener("unhandledrejection",r._rollbarURH);var n=function(r){var o,n,t;try{o=r.reason}catch(r){o=void 0}try{n=r.promise}catch(r){n="[unhandledrejection] error getting `promise` from event"}try{t=r.detail,!o&&t&&(o=t.reason,n=t.promise)}catch(r){}o||(o="[unhandledrejection] error getting `reason` from event"),e&&e.handleUnhandledRejection&&e.handleUnhandledRejection(o,n)};n.belongsToShim=o,r._rollbarURH=n,r.addEventListener("unhandledrejection",n)}},wrapGlobals:function(r,e,n){if(r){var t,a,l="EventTarget,Window,Node,ApplicationCache,AudioTrackList,ChannelMergerNode,CryptoOperation,EventSource,FileReader,HTMLUnknownElement,IDBDatabase,IDBRequest,IDBTransaction,KeyOperation,MediaController,MessagePort,ModalWindow,Notification,SVGElementInstance,Screen,TextTrack,TextTrackCue,TextTrackList,WebSocket,WebSocketWorker,Worker,XMLHttpRequest,XMLHttpRequestEventTarget,XMLHttpRequestUpload".split(",");for(t=0;t<l.length;++t)r[a=l[t]]&&r[a].prototype&&o(e,r[a].prototype,n)}}}},function(r,e){function o(r,e){this.impl=r(e,this),this.options=e,function(r){for(var e=function(r){return function(){var e=Array.prototype.slice.call(arguments,0);if(this.impl[r])return this.impl[r].apply(this.impl,e)}},o="log,debug,info,warn,warning,error,critical,global,configure,handleUncaughtException,handleAnonymousErrors,handleUnhandledRejection,_createItem,wrap,loadFull,shimId,captureEvent,captureDomContentLoaded,captureLoad".split(","),n=0;n<o.length;n++)r[o[n]]=e(o[n])}(o.prototype)}o.prototype._swapAndProcessMessages=function(r,e){var o,n,t;for(this.impl=r(this.options);o=e.shift();)n=o.method,t=o.args,this[n]&&"function"==typeof this[n]&&("captureDomContentLoaded"===n||"captureLoad"===n?this[n].apply(this,[t[0],o.ts]):this[n].apply(this,t));return this},r.exports=o},function(r,e){r.exports=function(r){return function(e){if(!e&&!window._rollbarInitialized){for(var o,n,t=(r=r||{}).globalAlias||"Rollbar",a=window.rollbar,l=function(r){return new a(r)},i=0;o=window._rollbarShims[i++];)n||(n=o.handler),o.handler._swapAndProcessMessages(l,o.messages);window[t]=n,window._rollbarInitialized=!0}}}}]);

  </script>





</head>
<body class="light-background logged-out prevention  unknown_device unknown_browser unknown_browser0 windows non-ie">

  <div class="content">


      <div class="header">
  <nav class="navbar navbar-expand-lg ">

    <div class="container-fluid">
      <button class="navbar-toggler navbar-toggler-right"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#collapsing-menu">
        <i class="fa fa-bars"></i>
      </button>


      <span class="navbar-brand logo">
        <a href="../index.html">
          <div class="title">iXi</div>
        </a>
      </span>

      <div class="navbar-collapse collapse justify-content-end" id="collapsing-menu">

        <div class="navbar-nav mr-auto">

        </div>

        <ul class="navbar-nav justify-content-end">


            <li class="nav-item nav-features"><a class="nav-link" href="../features.html">Features</a></li>
            <li class="nav-item nav-lessons"><a class="nav-link" href="../lessons.html">Lessons</a></li>
            <li class="nav-item nav-enterprise"><a class="nav-link" href="../enterprise.html">Enterprise</a></li>
            <li class="nav-item nav-owasp top 10"><a class="nav-link" href="../owasp.html">OWASP Top 10</a></li>
            <li class="nav-item nav-pci compliance"><a class="nav-link" href="../pci.html">PCI Compliance</a></li>
            <li class="nav-item nav-the book"><a class="nav-link" href="../book.html">The Book</a></li>
            <li class="nav-item nav-login"><a class="nav-link" href="../login.html">Login</a></li>
            <li class="nav-item nav-signup"><a class="nav-link" href="../join.html">SignUp</a></li>


        </ul>
      </div>
    </div>

  </nav>
</div>


      
<script>
  hljs.configure({ classPrefix: 'code-' });
  hljs.highlightAll();
</script>

<div class="main reading sql-injection">

  <div class="container">
    <div class="row prevention-tips has-sponsor">
      <div class="row title modest">
        Protecting Against SQL Injection
      </div>

      
<p><strong>SQL injection</strong> is a type of <a href="../glossary/code-injection.html">injection attack</a>.
Injection attacks occur when maliciously crafted inputs are submitted
by an attacker, causing an application to perform an unintended action.
Because of the ubiquity of <a href="../glossary/sql.html">SQL</a> databases,
SQL injection is one of the most common types of attack on the internet.</p>

<p class="well"><strong>If you only have time to protect yourself against one
vulnerability, you should be checking for SQL injection vulnerabilities
in your codebase!</strong></p>



      <h3 id="risks">Risks</h3>

      <div class="ratings">
  <div class="rating prevalence occasional">
    <div class="category">
      <span class="category-label">
        Prevalence
      </span>

      <span class="description">
        Occasional
      </span>
    </div>

    <div class="level">
      <div class="rating-icons prevalence occasional">
        <img class="on one" src="../../d1o5lmfp4gliop.cloudfront.net/assets/icons/rating-prevelance-on-08c87a35753a8cffcf36b11e7964cfaf357ed53beea25705689f8b289b9260db.png" />
        <img class="on two" src="../../d1o5lmfp4gliop.cloudfront.net/assets/icons/rating-prevelance-on-08c87a35753a8cffcf36b11e7964cfaf357ed53beea25705689f8b289b9260db.png" />
        <img class="on three" src="../../d1o5lmfp4gliop.cloudfront.net/assets/icons/rating-prevelance-on-08c87a35753a8cffcf36b11e7964cfaf357ed53beea25705689f8b289b9260db.png" />
      </div>
   </div>
  </div>

  <div class="rating exploitability easy">
    <div class="category">
      <span class="category-label">
        Exploitability
      </span>

      <span class="description">
        Easy
      </span>
    </div>

    <div class="level">
      <div class="rating-icons exploitability easy"">
        <img class="on one" src="../../d1o5lmfp4gliop.cloudfront.net/assets/icons/rating-exploitability-on-72a414cbfd6607547d507635de7609d1ba1bbfc36e454851949c4efc6fdd6f82.png" />
        <img class="on two" src="../../d1o5lmfp4gliop.cloudfront.net/assets/icons/rating-exploitability-on-72a414cbfd6607547d507635de7609d1ba1bbfc36e454851949c4efc6fdd6f82.png" />
        <img class="on three" src="../../d1o5lmfp4gliop.cloudfront.net/assets/icons/rating-exploitability-on-72a414cbfd6607547d507635de7609d1ba1bbfc36e454851949c4efc6fdd6f82.png" />
      </div>
    </div>
  </div>

  <div class="rating impact devastating">
    <div class="category">
      <span class="category-label">
        Impact
      </span>

      <span class="description">
        Devastating
      </span>
    </div>

    <div class="level">
      <div class="rating-icons impact devastating">
        <img class="on one" src="../../d1o5lmfp4gliop.cloudfront.net/assets/icons/rating-impact-on-56af21599bf07cebbffbecceec1537a9471628fb1d3374433c1d9b8b1ab703bf.png" />
        <img class="on two" src="../../d1o5lmfp4gliop.cloudfront.net/assets/icons/rating-impact-on-56af21599bf07cebbffbecceec1537a9471628fb1d3374433c1d9b8b1ab703bf.png" />
        <img class="on three" src="../../d1o5lmfp4gliop.cloudfront.net/assets/icons/rating-impact-on-56af21599bf07cebbffbecceec1537a9471628fb1d3374433c1d9b8b1ab703bf.png" />
      </div>
    </div>
  </div>
</div>

      <p><strong>What’s the worst thing that could happen when you suffer a SQL injection 
attack?</strong></p>

<p>Our <a href="../exercises/sql-injection.html">example hack</a> showed you how to bypass
the login page: a huge security flaw for a banking site. More complex attacks
will allow an attacker to run arbitrary statements on the database. In the past,
hackers have used injection attacks to:</p>

<ul>
  <li>
<strong>Extract sensitive information</strong>, like Social Security numbers, or credit card details.</li>
  <li>
<strong>Enumerate the authentication details of users registered on a website,</strong> so these logins can be used in attacks on other sites.</li>
  <li>
<strong>Delete data or drop tables</strong>, corrupting the database, and making the website unusable.</li>
  <li>
<strong>Inject further malicious code</strong> to be executed when users visit the site.</li>
</ul>

<p><strong>SQL injection attacks are astonishingly common.</strong> Major companies like
<a href="http://www.cbsnews.com/news/yahoo-reportedly-hacked-is-your-account-safe">Yahoo</a> and
<a href="https://www.wired.com/2011/06/sony-lulzsec/">Sony</a>
have had their applications compromised. In other cases, hacker groups targeted
<a href="http://arstechnica.com/security/2015/02/more-than-1-million-wordpress-websites-imperiled-by-critical-plugin-bug">specific applications</a> or
wrote scripts intended to harvest authentication details.
Not even <a href="http://arstechnica.com/tech-policy/2011/02/anonymous-speaks-the-inside-story-of-the-hbgary-hack">security firms</a> 
are immune!</p>




      <h3 id="protection">Protection</h3>

<p><strong>So SQL Injection is a serious risk. How can you protect yourself?</strong></p>

<h6 id="parameterized-statements">Parameterized Statements</h6>

<p>Programming languages talk to SQL databases using <strong>database drivers.</strong>
A driver allows an application to construct and run SQL statements against
a database, extracting and manipulating data as needed. <strong>Parameterized statements</strong>
make sure that the parameters (i.e. inputs) passed into SQL statements are treated in a safe manner.</p>

<p>For example, a secure way of running a SQL query in <a href="https://docs.oracle.com/javase/tutorial/jdbc/basics/index.html">JDBC</a>
using a parameterized statement would be:</p>

<pre class="good"><code class="language-java">
// Connect to the database.
Connection conn = DriverManager.getConnection(URL, USER, PASS);

// Construct the SQL statement we want to run, specifying the parameter.
String sql = "SELECT * FROM users WHERE email = ?";

// Generate a prepared statement with the placeholder parameter.
PreparedStatement stmt = conn.prepareStatement(sql);

// Bind email value into the statement at parameter index 1.
stmt.setString(1, email);

// Run the query...
ResultSet results = stmt.executeQuery(sql);

while (results.next())
{
    // ...do something with the data returned.
}

</code></pre>

<p>Contrast this to explicit construction of the SQL string, which is
<strong>very, very dangerous</strong>:</p>

<pre class="bad"><code class="language-java">
// The user we want to find.
String email = "user@email.com";

// Connect to the database.
Connection conn = DriverManager.getConnection(URL, USER, PASS);
Statement stmt = conn.createStatement();

// Bad, bad news! Don't construct the query with string concatenation.
String sql = "SELECT * FROM users WHERE email = '" + email + "'";

// I have a bad feeling about this...
ResultSet results = stmt.executeQuery(sql);

while (results.next()) {
  // ...oh look, we got hacked.
}

</code></pre>

<p>The key difference is the data being passed to the <code>executeQuery(...)</code>
method. In the first case, the parameterized string and the parameters are passed
to the database separately, which allows the driver to correctly interpret them.
In the second case, the full SQL statement is constructed before the driver is
invoked, meaning we are vulnerable to maliciously crafted parameters.</p>

<p><strong>You should always use parameterized statements where available, they are your
number one protection against SQL injection.</strong></p>

<p>You can see more examples of parameterized statements in various languages
in the <a href="#code-samples">code samples</a> below.</p>

<h6 id="object-relational-mapping">Object Relational Mapping</h6>

<p>Many development teams prefer to use <strong>Object Relational Mapping (ORM)</strong>
frameworks to make the translation of SQL result sets into code objects
more seamless. ORM tools often mean developers will rarely have to write SQL 
statements in their code – and these tools thankfully use parameterized 
statements under the hood.</p>

<p>The most well-known ORM is probably Ruby on Rails’ <strong>Active Record</strong> framework.
Fetching data from the database using Active Record looks like this:</p>

<pre class="good"><code class="language-ruby">
def current_user(email)
  # The 'User' object is an Active Record object, that has find methods 
  # auto-magically generated by Rails.
  User.find_by_email(email)
end

</code></pre>

<p>Code like this is safe from SQL Injection attacks.</p>

<p><strong>Using an ORM does not automatically make you immune to SQL injection, however.</strong>
Many ORM frameworks allow you to construct SQL statements, or fragments of SQL statements,
when more complex operations need to be performed on the database. For
example, the following Ruby code <em>is</em> vulnerable to injection attacks:</p>

<pre class="bad"><code class="language-ruby">
def current_user(email)
  # This code would be vulnerable to a maliciously crafted email parameter.
  User.where("email = '" + email + "'")
end

</code></pre>

<p><strong>As a general rule of thumb:</strong> if you find yourself writing SQL statements by
concatenating strings, think very carefully about what you are doing.</p>

<h6 id="escaping-inputs">Escaping Inputs</h6>

<p>If you are unable to use parameterized statements or a library that
writes SQL for you, the next best approach is to ensure proper escaping
of special string characters in input parameters.</p>

<p>Injection attacks often rely on the attacker being able to craft an input that
will prematurely close the argument string in which they appear in the
SQL statement. (This is why you you will often see <code>'</code> or <code>"</code> characters in
attempted SQL injection attacks.)</p>

<p>Programming languages have standard ways to describe strings containing
quotes within them – SQL is no different in this respect. Typically,
doubling up the quote character – replacing <code>'</code> with <code>''</code> – means 
<strong>“treat this quote as part of the string, not the end of the string”.</strong></p>

<p>Escaping symbol characters is a simple way to protect against most SQL
injection attacks, and many languages have <a href="https://www.php.net/manual/en/mysqli.real-escape-string.php">standard functions</a>
to achieve this.  There are a couple of drawbacks to this approach, however:</p>

<ul>
  <li><strong>You need to be very careful to escape characters everywhere in your codebase 
where an SQL statement is constructed.</strong></li>
  <li>
<strong>Not all injection attacks rely on abuse of quote characters.</strong>
For example, when an numeric ID is expected in a SQL statement, quote 
characters are not required. The following code is still vulnerable to 
injection attacks, no matter how much you play around with quote characters:</li>
</ul>

<pre><code class="language-ruby">
def current_user(id)
  User.where("id = " + id)
end

</code></pre>

<h6 id="sanitizing-inputs">Sanitizing Inputs</h6>

<p>Sanitizing inputs is a good practice for all applications. In our
<a href="../exercises/sql-injection.html">example hack</a>, the user supplied a password as 
<code>' or 1=1--</code>, which looks pretty suspicious as a password choice.</p>

<p>Developers should always make an effort to reject inputs that look suspicious 
out of hand, while taking care not to accidentally punish legitimate users. For 
instance, your application may clean parameters supplied in <a href="../glossary/http.html">GET</a> 
and <a href="../glossary/http.html">POST</a> requests in the following ways:</p>

<ul>
  <li>Check that supplied fields like email addresses match a regular expression.</li>
  <li>Ensure that numeric or alphanumeric fields do not contain symbol characters.</li>
  <li>Reject (or strip) out whitespace and new line characters where they are not appropriate.</li>
</ul>

<p class="well"><strong>Client-side validation (i.e. in JavaScript) is useful for giving the user
immediate feedback when filling out a form, but is no defense against a
serious hacker. Most hack attempts are performed using scripts, rather
than the browser itself.</strong></p>

<h3 id="code-samples">Code Samples</h3>

<p>The code samples below illustrate good and bad practices when trying to
protect against SQL injection.</p>

<a class="toggle collapsed" data-bs-toggle="collapse" href="#pythona82a5e9a-21cf-47b3-9f82-f119301ab3bc-examples" aria-expanded="false" aria-controls="pythona82a5e9a-21cf-47b3-9f82-f119301ab3bc-examples"><h5 id="python">Python</h5></a><span id="pythona82a5e9a-21cf-47b3-9f82-f119301ab3bc-examples" class="collapse">

<h6 id="db-20-api">DB 2.0 API</h6>

<pre class="good"><code class="language-python">
# SQL and parameter is sent off separately to the database driver.
cursor.execute("select user_id, user_name from users where email = ?", email)

for row in cursor.fetchall():
  print row.user_id, row.user_name

</code></pre>

<pre class="bad"><code class="language-python">
# String concatenation is vulnerable.
cursor.execute("select user_id, user_name from users where email = '%s'" % email)

for row in cursor.fetchall():
  print row.user_id, row.user_name

</code></pre>

<h6 id="django">Django</h6>

<pre class="good"><code class="language-python">
# Fetch using a user using native ORM syntax, good.
Users.objects.filter(email=email)

</code></pre>

<pre class="good"><code class="language-python">
# Fetch a user using raw SQL, also safe.
Users.objects.raw("select * from users where email = %s", [email])

</code></pre>

<pre class="bad"><code class="language-python">
# Liable to get hacked.
Users.objects.raw("select * from users where email = '%s'" % email)

</code></pre>

</span><a class="toggle collapsed" data-bs-toggle="collapse" href="#ruby34398b02-ffd6-48f5-ad2f-1dd8919c1d56-examples" aria-expanded="false" aria-controls="ruby34398b02-ffd6-48f5-ad2f-1dd8919c1d56-examples"><h5 id="ruby">Ruby</h5></a><span id="ruby34398b02-ffd6-48f5-ad2f-1dd8919c1d56-examples" class="collapse">

<h6 id="active-record">Active Record</h6>

<pre class="good"><code class="language-ruby">
def current_user(email)
   User.find_by_email(email)
end

</code></pre>

<pre class="bad"><code class="language-ruby">
def current_user(email)
  User.where("email = '" + email + "'")
end

</code></pre>

<h6 id="sequel">Sequel</h6>

<pre class="good"><code class="language-ruby">
def current_user(email)
  User.where(:email=&gt;email)
end

</code></pre>

<pre class="bad"><code class="language-ruby">
def current_user(email)
  User.where("email = #{params[:email]}")
end

</code></pre>

</span><a class="toggle collapsed" data-bs-toggle="collapse" href="#javac93aae57-ac4a-4de3-9a34-6d20ca8e0b6e-examples" aria-expanded="false" aria-controls="javac93aae57-ac4a-4de3-9a34-6d20ca8e0b6e-examples"><h5 id="java">Java</h5></a><span id="javac93aae57-ac4a-4de3-9a34-6d20ca8e0b6e-examples" class="collapse">

<h6 id="jdbc">JDBC</h6>

<pre class="good"><code class="language-java">
// Connect to the database.
Connection conn = DriverManager.getConnection(URL, USER, PASS);

// Construct the SQL statement we want to run, specifying the parameter.
String sql = "SELECT * FROM users WHERE email = ?";

// Generate a prepared statement with the placeholder parameter.
PreparedStatement stmt = conn.prepareStatement(sql);

// Bind email value into the statement at parameter index 1.
stmt.setString(1, email);

// Run the query...
ResultSet results = stmt.executeQuery(sql);

while (results.next())
{
    // ...do something with the data returned.
}

</code></pre>

<pre class="bad"><code class="language-java">
// The user we want to find.
String email = "user@email.com";

// Connect to the database.
Connection conn = DriverManager.getConnection(URL, USER, PASS);
Statement stmt = conn.createStatement();

// Bad, bad news! Don't construct the query with string concatenation.
String sql = "SELECT * FROM users WHERE email = '" + email + "'";

// I have a bad feeling about this...
ResultSet results = stmt.executeQuery(sql);

while (results.next()) {
  // ...oh look, we got hacked. 
}

</code></pre>

<h6 id="hibernate">Hibernate</h6>

<pre class="good"><code class="language-java">
@Entity
public class User {
  @Id
  @GeneratedValue
  Long id;

  @NaturalId
  String email;
}

// ORM will ensure safe passing of the 'email' parameter.
return session.bySimpleNaturalId(User.class).load(email);

</code></pre>

<h6 id="spring">Spring</h6>

<pre class="good"><code class="language-java">
public Customer findUserByEmail(String email) {
  String sql = "select * from users where email = ?";

  User user = (User) getJdbcTemplate().queryForObject(
    sql,                    // SQL statement...
    new Object[] { email }, // ...separate from parameters.
    new UserRowMapper());

  return user;
}

</code></pre>

</span><a class="toggle collapsed" data-bs-toggle="collapse" href="#c356826d2cc-00bd-43a5-a5e3-c296fece2f36-examples" aria-expanded="false" aria-controls="c356826d2cc-00bd-43a5-a5e3-c296fece2f36-examples"><h5 id="c35">C#</h5></a><span id="c356826d2cc-00bd-43a5-a5e3-c296fece2f36-examples" class="collapse">

<h6 id="sqlclient">SqlClient</h6>

<pre class="good"><code class="language-cs">
// Create the SQL command.
SqlCommand command = new SqlCommand("select * from Users where email = @email", conn);

// Add the parameter values in separately.
command.Parameters.Add(new SqlParameter("email", email);

using (SqlDataReader reader = command.ExecuteReader())
{
  while (reader.Read())
  {
    // Do something with the retrieved data.
  }
}

</code></pre>

<h6 id="linq">LINQ</h6>

<pre class="good"><code class="language-cs">
using (ServiceContext ctx = new ServiceContext(...))
{
  // LINQ will ensure safe passing of parameters.
  var users = from user in ctx.Users
             where user.email equals email
            select user;

  foreach (var user in users)
  {
    // Do something with the retrieved data
  }
}

</code></pre>

</span><a class="toggle collapsed" data-bs-toggle="collapse" href="#node97d3d43b-5552-4401-bdd9-3929cf0617f9-examples" aria-expanded="false" aria-controls="node97d3d43b-5552-4401-bdd9-3929cf0617f9-examples"><h5 id="node">Node</h5></a><span id="node97d3d43b-5552-4401-bdd9-3929cf0617f9-examples" class="collapse">

<h6 id="node-sql">node-sql</h6>

<pre class="good"><code class="language-javascript">
var sql = require('sql');

// Queries are constructed as parameterized by default.
var query = user.select(user.star()))
                .from(user)
                .where(
                   user.email.equals(email)
                 ).toQuery();
</code></pre>

<h6 id="mysql">mysql</h6>

<pre class="good"><code class="language-javascript">
var mysql = require('mysql');

var connection = mysql.createConnection({
  host     : HOST,
  user     : USERNAME,
  password : PASSWORD
});

connection.connect();

// Query and parameters passed separately.
connection.query(
  'select * from users where email = ?',
  [email],
  function(err, rows, fields) {
    // Do something with the retrieved data.
  });

connection.end();

</code></pre>

<h6 id="pg">pg</h6>

<pre class="good"><code class="language-javascript">
var pg = require('pg');

var connection = "postgres://username:password@localhost/database";

var client = new pg.Client(connection);

// Query and parameters passed separately.
client.connect(function(err) {
  client.query(
    'select * from users where email = ?',
    [email],
    function(err, result) {
      // Do something with the retrieved data.
    });
  });

client.end();

</code></pre>

</span><a class="toggle collapsed" data-bs-toggle="collapse" href="#php6747741f-9384-4cb0-93de-5ccc173966d1-examples" aria-expanded="false" aria-controls="php6747741f-9384-4cb0-93de-5ccc173966d1-examples"><h5 id="php">PHP</h5></a><span id="php6747741f-9384-4cb0-93de-5ccc173966d1-examples" class="collapse">

<pre class="good"><code class="language-php">
$statement = $dbh-&gt;prepare("select * from users where email = ?");
$statement-&gt;execute(array(email));

</code></pre>

</span><h3 id="other-considerations">Other Considerations</h3>

<h6 id="principle-of-least-privilege">Principle of Least Privilege</h6>

<p>Applications should ensure that each process or software component can
access and affect only the resources it needs. Apply “levels of clearance”
as appropriate, in the same way that only certain bank employees have
access to the vault. Applying <a href="../glossary/principle-of-least-privilege.html">restricted privileges</a>
can help mitigate a lot of the risk around injection attacks.</p>

<p>It is rarely necessary for applications to change the <em>structure</em> of
the database at run-time – typically tables are created, dropped, and
modified during release windows, with temporarily elevated permissions.
Therefore, it is good practice to reduce the permissions of the application
at runtime, so it can at most <em>edit</em> data, but not change table structures.
In a SQL database, this means making sure your production accounts can
only execute <a href="../glossary/dml.html">DML</a> statements, not <a href="../glossary/ddl.html">DDL</a>
statements.</p>

<p>With complex database designs, it can be worth making these permissions
even more fine-grained. Many processes can be permissioned to perform data
edits only through stored procedures, or to execute with read-only permissions.</p>

<p>Sensibly designing access management in this way can provide a vital second
line of defense. No matter how the attacker gets access to your system, it
can mitigate the type of damage they can possibly do.</p>

<h6 id="password-hashing">Password Hashing</h6>

<p>Our <a href="../exercises/sql-injection.html">example hack</a> relied on the fact that the password was
stored as plain-text in the database. In fact, storing unencrypted passwords is a 
major security flaw in itself. Applications should store user passwords as 
<a href="../glossary/hashing.html">strong, one-way hashes</a>, preferably 
<a href="../glossary/salting.html">salted</a>. This mitigates the risk of malicious users stealing 
credentials, or impersonating other users.</p>

<h6 id="third-party-authentication">Third Party Authentication</h6>

<p>As a final note, it is often worth considering out-sourcing the authentication
workflow of your application entirely. Facebook, Twitter, and Google all provide
mature <a href="../glossary/oauth.html">OAuth</a> APIs, which can be used to let users log into your 
website using their existing accounts on those systems. This saves you as an 
application developer from rolling your own authentication, and assures your
users that their passwords are only stored in a single location.</p>

<h3 id="further-reading">Further Reading</h3>

<ul>
  <li><a href="https://www.acunetix.com/blog/articles/exploiting-sql-injection-example/?utm_source=iXi&amp;utm_medium=post&amp;utm_campaign=articlelink">Exploiting SQL Injection</a></li>
  <li><a href="https://www.netsparker.com/blog/web-security/sql-injection-cheat-sheet/?utm_source=iXi&amp;utm_medium=post&amp;utm_campaign=articlelink">SQL Injection Cheatsheet</a></li>
  <li><a href="http://xkcd.com/327/">Relevant XKCD</a></li>
</ul>


    </div>

      



  </div>


    <div class="container">
      <div class="row quiz-link">
        <a href="../joine9db.html?next=%2Fquiz%2Fsql-injection">
          <div class="link-question">
            Got all that?
          </div>

          <div class="link-link">
            Test Yourself →
          </div>

          <div class="link-caption">
            <div>Take our quiz to make sure everything is clear</div>
          </div>
</a>      </div>
    </div>



</div>

      
  <footer class="regular">
  <div class="container">
    <ul>
      <li>
        <a href="../lessons.html">Lessons</a>
      </li>
      <li>
        <a href="../glossary.html">Glossary</a>
      </li>
      <li>
        <a href="../privacy.html">Privacy</a>
      </li>
      <li>
        <a href="../legal.html">Legal</a>
      </li>

      <li class="pull-right copyright">
          <a class="contact-us"
             title="Get in touch"
             href="mailto:question@iXi.com"
             rel="noopener noreferrer">
            <span class="fa-stack">
              <i class="fa fa-circle fa-stack-2x"></i>
              <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
            </span>
          </a>

        <a href="../index.html">
          <span style="font-family: 'Oxygen'">©</span> 2022 iXi
</a>      </li>
    </ul>
  </div>
</footer>



  </div>

    <script src="../../d1o5lmfp4gliop.cloudfront.net/assets/cookieinfo-1af9cc137c2c2bc8ea4d469f45d357ec43dc6c23537bd0c96aa9b51ff416ce5e.js" id="cookieinfo"></script>

</body>

<script>
  $(function () {
    $('[data-bs-toggle="tooltip"]').tooltip({ container: 'body' });
  });
</script>


<!-- Mirrored from www.iXi.com/prevention/sql-injection by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 14 Aug 2022 09:49:37 GMT -->
</html>
